<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Experimental Setup</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- Personalized CSS -->
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card">
            <div class="card-header">Experimental Setup</div>
            <div class="card-body" id="form-container">
              <form action="process_form.php" method="POST">
                <!-- Submit form data to process_form.php -->
                <div class="form-group">
                  <label for="filename">File Name:</label>
                  <input
                    type="text"
                    class="form-control"
                    id="filename"
                    name="filename"
                  />
                </div>
                <div class="card-header">Trials</div>
                <div class="card-body" id="trial-container"></div>
                <button type="button" class="btn btn-success" id="add-trial">
                  Add Trial
                </button>
                <button
                  type="submit"
                  class="btn btn-success"
                  id="send-form"
                  name="send-form"
                >
                  Send
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Custom JS -->
    <script>
      $(document).ready(function () {
        var trialCount = 1; // Trial counter

        // Function to add another form
        $("#add-trial").click(function () {
          var trialHtml = '<div class="trial">';
          trialHtml +=
            '<div class="card-header trial-header">Trial ' +
            trialCount +
            "</div>";
          trialHtml += '<div class="card-body">';

          // Array of objects to represent each input group
          var inputGroups = [
            { label: "Environment:", type: "text", name: "envname" },
            { label: "Maximum Time:", type: "time", name: "maxtime" },
            { label: "SET_SCENE:", type: "text", name: "setscene" },
            { label: "REMARKS:", type: "text", name: "remarks" },
            {
              label: "TRACKING_DIAMETER:",
              type: "float",
              name: "trackingdiameter",
            },
            {
              label: "TRACKING_AREA_NORTH:",
              type: "float",
              name: "trackingareanorth",
            },
            // Add more input groups as needed
          ];

          // Add each input group to the form
          inputGroups.forEach(function (group, index) {
            trialHtml += '<div class="form-group">';
            trialHtml +=
              '<label for="' + group.name + '">' + group.label + "</label>";
            trialHtml +=
              '<input type="' +
              group.type +
              '" class="form-control" name="' +
              group.name +
              '[]">';
            trialHtml += "</div>";
          });

          trialHtml +=
            '<button type="button" class="btn btn-danger remove-trial">Remove Trial</button>';
          trialHtml += "</div>";
          trialHtml += "</div>";

          $("#trial-container").append(trialHtml);
          trialCount++; // Increment the trial counter
        });

        // Function to remove a form
        $(document).on("click", ".remove-trial", function () {
          $(this).closest(".trial").remove();
          trialCount--; // Decrement the trial counter
        });

        // Function to submit the form and generate the text file
        $("#send-form").click(function () {
          var filename = $("#filename").val().trim();
          var content = "Experimental Setup\n\n";

          // Collect data from each trial
          $(".trial").each(function () {
            var trialHeader = $(this).find(".card-header").text().trim();
            var inputs = $(this).find(".form-control");

            content += trialHeader + "\n";

            // Add content from each input group to the text
            inputs.each(function () {
              var label = $(this).prev("label").text();
              var value = $(this).val().trim();
              content += label + ": " + value + "\n";
            });

            content += "\n";
          });

          // Create and download the text file
          var element = document.createElement("a");
          element.setAttribute(
            "href",
            "data:text/plain;charset=utf-8," + encodeURIComponent(content)
          );
          element.setAttribute("download", filename + ".txt");
          element.style.display = "none";
          document.body.appendChild(element);
          element.click();
          document.body.removeChild(element);
        });
      });
    </script>
  </body>
</html>
